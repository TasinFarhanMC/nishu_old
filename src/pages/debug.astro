---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <h1>Encrypt / Decrypt Debugger</h1>

  <!-- ENCRYPT SECTION -->
  <div style="margin-bottom:2rem; padding:1rem; border:1px solid #ccc;">
    <h2>Encrypt</h2>
    <div style="margin-bottom:1rem;">
      <label>String to encrypt:</label><br />
      <input
        type="text"
        id="encrypt-message"
        style="width:100%;"
        placeholder="Enter text"
      />
    </div>
    <div style="margin-bottom:1rem;">
      <label>Password:</label><br />
      <input
        type="password"
        id="encrypt-password"
        style="width:100%;"
        placeholder="Enter password"
      />
    </div>
    <button id="encrypt-btn">Encrypt</button>
    <div style="margin-top:1rem;">
      <strong>Encrypted:</strong>
      <textarea
        id="encrypt-output"
        style="width:100%; height:3rem; background:#f0f0f0; padding:0.5rem;"
        readonly
      ></textarea>
    </div>
  </div>

  <!-- DECRYPT SECTION -->
  <div style="margin-bottom:2rem; padding:1rem; border:1px solid #ccc;">
    <h2>Decrypt</h2>
    <div style="margin-bottom:1rem;">
      <label>Encrypted string:</label><br />
      <input
        type="text"
        id="decrypt-message"
        style="width:100%;"
        placeholder="Paste encrypted string"
      />
    </div>
    <div style="margin-bottom:1rem;">
      <label>Password:</label><br />
      <input
        type="password"
        id="decrypt-password"
        style="width:100%;"
        placeholder="Enter password"
      />
    </div>
    <button id="decrypt-btn">Decrypt</button>
    <div style="margin-top:1rem;">
      <strong>Decrypted:</strong>
      <textarea
        id="decrypt-output"
        style="width:100%; height:3rem; background:#f0f0f0; padding:0.5rem;"
        readonly
      ></textarea>
    </div>
  </div>

  <script>
    import { encrypt, decrypt } from "../assets/crypto.ts";

    // --- ENCRYPT ---
    const encryptBtn = document.getElementById("encrypt-btn");
    const encryptMessageInput = document.getElementById("encrypt-message");
    const encryptPasswordInput = document.getElementById("encrypt-password");
    const encryptOutput = document.getElementById("encrypt-output");

    encryptBtn.addEventListener("click", async () => {
      const msg = encryptMessageInput.value;
      const password = encryptPasswordInput.value;
      console.log("Encrypt Input:", { msg, password });

      if (!msg || !password) return alert("Enter both message and password");
      try {
        const encrypted = await encrypt(msg, password);
        console.log("Encrypted Output:", encrypted);
        encryptOutput.value = encrypted;
      } catch (err) {
        console.error("Encryption Error:", err);
        encryptOutput.value = "❌ Encryption failed";
      }
    });

    encryptOutput.addEventListener("click", () => encryptOutput.select());

    // --- DECRYPT ---
    const decryptBtn = document.getElementById("decrypt-btn");
    const decryptMessageInput = document.getElementById("decrypt-message");
    const decryptPasswordInput = document.getElementById("decrypt-password");
    const decryptOutput = document.getElementById("decrypt-output");

    decryptBtn.addEventListener("click", async () => {
      const encrypted = decryptMessageInput.value;
      const password = decryptPasswordInput.value;
      console.log("Decrypt Input:", { encrypted, password });

      if (!encrypted || !password)
        return alert("Enter both encrypted string and password");
      try {
        const decrypted = await decrypt(encrypted, password);
        console.log("Decrypted Output:", decrypted);
        decryptOutput.value = decrypted;
      } catch (err) {
        console.error("Decryption Error:", err);
        decryptOutput.value =
          "❌ Decryption failed: wrong password or corrupted data";
      }
    });

    decryptOutput.addEventListener("click", () => decryptOutput.select());
  </script>
</Layout>
